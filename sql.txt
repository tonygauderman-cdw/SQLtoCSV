select distinct enduser.userid, enduser.firstname, enduser.lastname, devicepool.name, devicenumplanmap.e164mask, enduser.telephonenumber, numplan.dnorpattern from device join devicenumplanmap on device.pkid=devicenumplanmap.fkdevice join numplan on devicenumplanmap.fknumplan=numplan.pkid join enduser on numplan.dnorpattern=enduser.telephonenumber or device.fkenduser=enduser.pkid join devicepool on device.fkdevicepool=devicepool.pkid join typemodel on device.tkmodel=typemodel.enum where (devicepool.name like '%SRST%' OR devicepool.name like 'Auto Registered Devices') AND ((devicenumplanmap.numplanindex='1') OR (enduser.telephonenumber=SUBSTR(numplan.dnorpattern,2) AND SUBSTR(numplan.dnorpattern,1,1)='\') OR (enduser.telephonenumber=numplan.dnorpattern)) and (typemodel.name matches 'Cisco [6789]*') order by numplan.dnorpattern